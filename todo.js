///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-----------------------------Global Variable----------------------//////////
const jsonfile = require('jsonfile');

const file = 'data.json'
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////--------------------To check if the object is null-----------------//////////
function isEmpty(obj) {
    for(let key in obj) {
        if(obj.hasOwnProperty(key))
            return false;
    }
    return true;
}

///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////--------------------To create from an empty file-----------------//////////
function createNewObject(obj){

      return obj["toDoItems"]=[
                                {   "id":1,
                                    "task":process.argv[3],
                                    "status":"[]",
                                    "created at":"15/03/20",
                                    "completed at": "Not Yet"
                                }
                            ]
}

///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////--------------------To add if file is not empty--------------------//////////
function addNewObject(obj){
    //console.log(obj["toDoItems"][1]);
    obj["toDoItems"].push(
                                    {
                                    "id":obj["toDoItems"].length+1,
                                    "task":process.argv[3],
                                    "status":"[]",
                                    "created at":"15/03/20",
                                    "completed at": "Not Yet"
                                    }
                                )
}

///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////--------------------To show data-----------------------------------//////////
function showData(obj){
    console.log(obj["toDoItems"].length);
}

jsonfile.readFile(file, (err, obj) => {

  console.log( obj);
  //console.log( process.argv[3]);

  if(process.argv[ 2 ] === "add" && process.argv[ 3 ] !== undefined)
  {

    if(isEmpty( obj ))
        {
            createNewObject(obj);
            console.log( "It is null" );
        }
    else
        {
            addNewObject(obj);
        }

    }
    else if(process.argv[2] === "show" && process.argv[ 3 ] === undefined)
    {
        showData(obj);
    }



  if(err){
    console.log("The error from reading is is "+err);
  }
//  obj["helloworld"] = "monkey";

jsonfile.writeFile(file, obj, (err) => {
    if(err)
    {   console.log(err);
        console.log("The writing error is " + err)
    }
  });
});
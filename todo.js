///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-----------------------------Global Variable----------------------//////////
const jsonfile = require('jsonfile');

const file = 'data.json'
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////--------------------To check if the object is null-----------------//////////
function isEmpty(obj) {
    for(let key in obj) {
        if(obj.hasOwnProperty(key))
            return false;
    }
    return true;
}

///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////--------------------To create from an empty file-----------------//////////
function createNewObject(obj){

      return obj["toDoItems"]=[
                                {   "id":1,
                                    "task":process.argv[3],
                                    "status":"[ ]",
                                    "created at":Date(),
                                    "completed at": "Not Yet"
                                }
                            ]
}

///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////--------------------To add if file is not empty--------------------//////////
function addNewObject(obj){
    //console.log(obj["toDoItems"][1]);
    obj["toDoItems"].push(
                                    {
                                    "id":obj["toDoItems"].length+1,
                                    "task":process.argv[3],
                                    "status":"[ ]",
                                    "created at":Date(),
                                    "completed at": "Not Yet"
                                    }
                                )
}

///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////--------------------To show data-----------------------------------//////////
function showData(obj){

    console.log(`#   ▄▀▀█▄▄   ▄▀▀█▄   ▄▀▀█▀▄   ▄▀▀▀▀▄  ▄▀▀▄ ▀▀▄      ▄▀▀▀█▀▀▄  ▄▀▀█▄   ▄▀▀▀▀▄  ▄▀▀▄ █
#  █ ▄▀   █ ▐ ▄▀ ▀▄ █   █  █ █    █  █   ▀▄ ▄▀     █    █  ▐ ▐ ▄▀ ▀▄ █ █   ▐ █  █ ▄▀
#  ▐ █    █   █▄▄▄█ ▐   █  ▐ ▐    █  ▐     █       ▐   █       █▄▄▄█    ▀▄   ▐  █▀▄
#    █    █  ▄▀   █     █        █         █          █       ▄▀   █ ▀▄   █    █   █
#   ▄▀▄▄▄▄▀ █   ▄▀   ▄▀▀▀▀▀▄   ▄▀▄▄▄▄▄▄▀ ▄▀         ▄▀       █   ▄▀   █▀▀▀   ▄▀   █
#  █     ▐  ▐   ▐   █       █  █         █         █         ▐   ▐    ▐      █    ▐
#  ▐                ▐       ▐  ▐         ▐         ▐                         ▐       `);

    for (let countObject = 0 ; countObject < obj["toDoItems"].length; countObject++)
    {
        console.log(`${obj["toDoItems"][countObject]["id"]}: ${obj["toDoItems"][countObject]["status"]} - ${obj["toDoItems"][countObject]["task"]}. Created at ${obj["toDoItems"][countObject]["created at"]}. Completed status/date: ${obj["toDoItems"][countObject]["completed at"]}`);
    }
}

///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////--------------------To change  status to done----------------------//////////
function changeStatus(obj, idStatus){
    for (let countObject = 0 ; countObject < obj["toDoItems"].length; countObject++)
    {
        if(idStatus===obj["toDoItems"][countObject]["id"])
        {
            obj["toDoItems"][countObject]["status"]="[X]";
            obj["toDoItems"][countObject]["completed at"]=Date();
        }
    }
}

///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////--------------------To update ID----------------------//////////
function updateId(obj){
    for (let countId = 0 ; countId < obj["toDoItems"].length; countId++)
    {
       obj["toDoItems"][countId]["id"]=countId+1;
    }
    return obj;
}

///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////-------------------------------------------------------------------//////////
///////--------------------To delete object----------------------//////////
function deleteObject(obj, idStatus){
    for (let countObject = 0 ; countObject < obj["toDoItems"].length; countObject++)
    {
        if(idStatus===obj["toDoItems"][countObject]["id"])
        {
            obj["toDoItems"].splice(countObject,1);
            break;
        }
    }
    return updateId(obj);
}


jsonfile.readFile(file, (err, obj) => {


  //console.log( process.argv[3]);

  if(process.argv[ 2 ] === "add" && process.argv[ 3 ] !== undefined)
  {

    if(isEmpty( obj ))
        {
            createNewObject(obj);
            console.log( "It is null" );
        }
    else
        {
            addNewObject(obj);
        }

    }
    else if(process.argv[2] === "show" && process.argv[ 3 ] === undefined)
    {
        showData(obj);
    }

    else if(process.argv[2]=== "done" && !isNaN(parseInt(process.argv[ 3 ])))
    {
        let idCheck=parseInt(process.argv[ 3 ]);
        changeStatus(obj,idCheck);

    }
    else if(process.argv[2]=== "delete" && !isNaN(parseInt(process.argv[ 3 ])))
    {
        console.log(obj);
        let idDelete=parseInt(process.argv[ 3 ]);
        obj=deleteObject(obj,idDelete);
        console.log(obj);

    }


  if(err){
    console.log("The error from reading is is "+err);
  }
//  obj["helloworld"] = "monkey";

jsonfile.writeFile(file, obj, (err) => {
    if(err)
    {   console.log(err);
        console.log("The writing error is " + err)
    }
  });
});